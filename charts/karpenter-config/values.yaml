# Default values for karpenter-config.
# Defines Karpenter NodePool and AKSNodeClass resources for AKS NAP clusters.

nodePools:
  general-purpose:
    # weight: priority when multiple NodePools match (0-100, higher = preferred)
    weight: 50
    template:
      metadata:
        labels:
          kubernetes.azure.com/ebpf-dataplane: cilium
      spec:
        nodeClassRef:
          group: karpenter.azure.com
          kind: AKSNodeClass
          name: default
        expireAfter: Never
        startupTaints:
          - key: node.cilium.io/agent-not-ready
            effect: NoExecute
            value: "true"
        requirements:
          - key: kubernetes.io/arch
            operator: In
            values: ["amd64"]
          - key: kubernetes.io/os
            operator: In
            values: ["linux"]
          - key: karpenter.sh/capacity-type
            operator: In
            values: ["on-demand"]
          - key: karpenter.azure.com/sku-family
            operator: In
            values: ["D"]
    limits:
      cpu: "100"
    disruption:
      consolidationPolicy: WhenEmptyOrUnderutilized
      consolidateAfter: 0s
      budgets:
        - nodes: "10%"

nodeClasses:
  default:
    imageFamily: Ubuntu
    osDiskSizeGB: 128
    tags: {}
